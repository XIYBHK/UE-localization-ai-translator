# 测试指南

## 🚀 快速开始

### 1. 环境要求

#### 必需工具
- **Node.js** >= 18.0.0
- **Rust** >= 1.70.0
- **npm** 或 **pnpm** 或 **yarn**

#### Windows 额外要求
- Visual Studio 2019 或更高版本（C++ 工具）
- WebView2 Runtime（Windows 10/11 通常已预装）

#### 检查环境
```bash
# 检查 Node.js
node --version

# 检查 Rust
rustc --version

# 检查 Cargo
cargo --version
```

### 2. 安装依赖

```bash
# 进入项目目录
cd po-translator-gui

# 安装前端依赖
npm install
# 或者
pnpm install
# 或者
yarn install
```

### 3. 运行开发模式

```bash
# 启动开发服务器（会同时编译 Rust 后端和启动前端）
npm run tauri:dev
```

**首次运行**可能需要较长时间（10-20分钟），因为需要：
- 编译 Rust 依赖（reqwest, tokio, tauri 等）
- 下载和编译所有 crates
- 构建 Tauri 应用

**后续运行**会快得多（1-2分钟），因为 Rust 增量编译。

### 4. 构建生产版本

```bash
# 构建可执行文件
npm run tauri:build
```

构建完成后，可执行文件位于：
- Windows: `src-tauri/target/release/po-translator-gui.exe`
- macOS: `src-tauri/target/release/bundle/dmg/`
- Linux: `src-tauri/target/release/bundle/appimage/`

## 📋 测试流程

### 阶段 1: 基础功能测试

#### 1.1 启动应用
- [ ] 应用成功启动，显示主界面
- [ ] 工具栏显示正常：🌐 PO 翻译工具
- [ ] 左侧条目列表为空
- [ ] 右侧显示提示信息："请从左侧列表选择一个条目进行编辑"

#### 1.2 配置 API 密钥
1. 点击工具栏的 **[设置]** 按钮
2. 在设置对话框中：
   - [ ] 输入 API 密钥（Moonshot 或 OpenAI）
   - [ ] 选择 AI 提供商（默认：Moonshot）
   - [ ] 选择模型（默认：moonshot-v1-8k）
   - [ ] 点击 **[保存]**
3. 验证：
   - [ ] 工具栏的警告提示消失
   - [ ] 显示成功提示："配置已保存！"

#### 1.3 打开 PO 文件
1. 点击工具栏的 **[打开]** 按钮
2. 选择测试 PO 文件（例如：`localization/zh-Hans/X_ToolkitTest.po`）
3. 验证：
   - [ ] 左侧列表显示所有翻译条目
   - [ ] 每个条目显示状态图标：
     - ✅ 已翻译（绿色勾号）
     - ⚪ 未翻译（蓝色圆圈）
     - ⚫ 空条目（灰色圆点）
   - [ ] 条目计数正确显示

### 阶段 2: 编辑功能测试

#### 2.1 选择条目
1. 点击左侧列表中的任一条目
2. 验证：
   - [ ] 条目高亮显示（蓝色背景）
   - [ ] 左侧出现蓝色边框
   - [ ] 右侧编辑器显示条目内容：
     - 原文（msgid）
     - 上下文（msgctxt，如有）
     - 注释（comments，如有）
     - 译文输入框

#### 2.2 手动翻译
1. 在译文输入框中输入翻译
2. 验证：
   - [ ] 输入内容实时保存
   - [ ] 状态栏更新字符数
   - [ ] 状态栏显示"✓ 已翻译"

#### 2.3 AI 翻译单条
1. 选择一个未翻译的条目
2. 点击 **[AI 翻译]** 按钮
3. 验证：
   - [ ] 按钮显示加载状态
   - [ ] 翻译完成后自动填充译文
   - [ ] 显示成功提示："自动翻译完成"

#### 2.4 复制功能
1. 点击原文区域的 **[复制]** 按钮
   - [ ] 显示提示："原文已复制到剪贴板"
2. 点击译文区域的 **[复制]** 按钮
   - [ ] 显示提示："译文已复制到剪贴板"

### 阶段 3: 批量翻译测试

#### 3.1 批量翻译
1. 点击工具栏的 **[批量翻译]** 按钮
2. 验证：
   - [ ] 按钮显示"翻译中..."
   - [ ] 列表上方显示进度条
   - [ ] 进度条实时更新（0% → 100%）
   - [ ] 翻译过程中可以看到条目状态变化
   - [ ] 完成后按钮恢复"批量翻译"

#### 3.2 翻译记忆库
1. 观察批量翻译过程
2. 验证：
   - [ ] 简单短语使用翻译记忆库（速度很快）
   - [ ] 复杂句子调用 AI 翻译（稍慢）
   - [ ] 控制台输出 TM 命中统计（如果有日志）

### 阶段 4: 保存功能测试

#### 4.1 保存文件
1. 完成翻译后，点击 **[保存]** 按钮
2. 选择保存位置
3. 验证：
   - [ ] 文件成功保存
   - [ ] 用文本编辑器打开保存的文件
   - [ ] 检查 msgstr 是否正确写入

#### 4.2 重新打开验证
1. 关闭应用
2. 重新启动应用
3. 打开刚才保存的文件
4. 验证：
   - [ ] 翻译内容完整保留
   - [ ] 状态图标正确显示

### 阶段 5: 边界情况测试

#### 5.1 空文件
- [ ] 打开一个空的或只有 header 的 PO 文件
- [ ] 应用不崩溃，显示空列表

#### 5.2 超长文本
- [ ] 选择包含超长原文的条目（>1000 字符）
- [ ] 编辑器正常显示，无溢出

#### 5.3 特殊字符
- [ ] 测试包含特殊字符的条目：
  - 换行符 `\n`
  - 占位符 `{0}`, `{1}`
  - Unicode 字符（中文、日文、emoji）
- [ ] 翻译后正确保存

#### 5.4 无 API 密钥
- [ ] 清空 API 密钥
- [ ] 验证 **[批量翻译]** 按钮禁用
- [ ] 显示警告提示

#### 5.5 网络错误
- [ ] 断网或使用无效 API 密钥
- [ ] 点击翻译
- [ ] 验证显示错误提示，不崩溃

## 🐛 常见问题排查

### 问题 1: 应用无法启动

**症状**: 运行 `npm run tauri:dev` 报错

**解决方案**:
```bash
# 1. 清理缓存
npm run tauri clean

# 2. 重新安装依赖
rm -rf node_modules
npm install

# 3. 重新构建
npm run tauri:dev
```

### 问题 2: Rust 编译错误

**症状**: 编译 Rust 代码时报错

**解决方案**:
```bash
# 更新 Rust
rustup update stable

# 清理 Cargo 缓存
cd src-tauri
cargo clean
cargo build
```

### 问题 3: 按钮点击无反应

**检查**:
1. 打开浏览器开发者工具（F12）
2. 查看 Console 是否有错误
3. 检查 API 密钥是否配置
4. 检查网络连接

### 问题 4: 翻译失败

**检查**:
1. API 密钥是否正确
2. API 额度是否充足
3. 网络是否正常
4. 查看控制台错误信息

## 📊 性能基准测试

### 测试数据
- **小文件**: < 100 条目
- **中等文件**: 100-500 条目  
- **大文件**: > 500 条目

### 预期性能
| 操作 | 小文件 | 中等文件 | 大文件 |
|------|--------|----------|--------|
| 打开文件 | < 1s | < 2s | < 5s |
| 批量翻译 | < 1min | 2-5min | 5-15min |
| 保存文件 | < 1s | < 2s | < 3s |

### TM 命中率
- 简单短语（≤35字符）: 30-50% 命中率
- 完整句子: 5-10% 命中率

## ✅ 测试检查清单

### 核心功能
- [ ] 打开 PO 文件
- [ ] 显示条目列表
- [ ] 选择和编辑条目
- [ ] 手动翻译
- [ ] AI 翻译单条
- [ ] AI 批量翻译
- [ ] 保存文件
- [ ] 翻译记忆库工作正常

### UI/UX
- [ ] 工具栏按钮响应
- [ ] 列表滚动流畅
- [ ] 编辑器输入流畅
- [ ] 进度条显示正确
- [ ] 状态提示清晰
- [ ] 错误处理友好

### 稳定性
- [ ] 无崩溃
- [ ] 无内存泄漏
- [ ] 长时间运行稳定
- [ ] 大文件处理正常

### 配置
- [ ] API 配置保存/加载
- [ ] 翻译记忆库持久化
- [ ] 多次启动配置保持

## 📝 测试报告模板

```markdown
## 测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: [姓名]
**版本**: v1.0.0
**操作系统**: Windows 11 / macOS / Linux

### 测试环境
- Node.js: vX.X.X
- Rust: vX.X.X
- Tauri: vX.X.X

### 测试结果
- ✅ 通过: XX 项
- ❌ 失败: XX 项
- ⚠️  警告: XX 项

### 问题列表
1. [问题描述]
   - 重现步骤: ...
   - 预期结果: ...
   - 实际结果: ...
   - 严重程度: 高/中/低

### 性能数据
- 打开 500 条目文件: X.Xs
- 批量翻译 100 条目: X.Xmin
- 内存占用: XXX MB

### 建议
- [改进建议 1]
- [改进建议 2]
```

## 🎯 下一步

测试通过后：
1. 记录测试结果
2. 修复发现的问题
3. 更新文档
4. 准备发布版本

## 📞 支持

遇到问题？
1. 查看 [README.md](./README.md)
2. 查看 [UI_IMPROVEMENTS.md](./UI_IMPROVEMENTS.md)
3. 提交 Issue 到 GitHub

