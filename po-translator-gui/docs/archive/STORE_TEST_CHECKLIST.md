# Store Plugin 测试清单

## 🎯 测试目标

验证 TauriStore 在真实环境中正常工作，用户设置能够持久化保存和恢复。

---

## ✅ 测试步骤

### 步骤 1: 启动应用

```bash
npm run tauri:dev
```

⏱️ **预计时间**: 首次编译 2-3 分钟

---

### 步骤 2: 检查初始化日志

打开应用后，查看**开发者工具控制台** (F12)

**应该看到以下日志**:

```
[App] 🚀 开始初始化 Store...
[Migration] 不需要迁移  (如果是新安装)
或
[Migration] 迁移完成，成功: 3, 失败: 0  (如果是从旧版升级)
[useSettingsStore] 设置加载成功 { theme: 'light', language: 'zh' }
[useStatsStore] 统计加载成功 { totalTranslated: 0, ... }
[App] ✅ Store 初始化完成
```

- [ ] ✅ 看到初始化日志
- [ ] ✅ 无错误提示
- [ ] ✅ Store 加载成功

---

### 步骤 3: 测试主题切换

1. **操作**: 点击右上角的主题切换按钮 🌙/☀️
2. **期望**: 
   - 界面主题立即改变 (暗色 ↔ 亮色)
   - 控制台显示: `[TauriStore] 设置 theme: dark`
3. **验证**:
   - [ ] ✅ 主题切换成功
   - [ ] ✅ 看到保存日志

---

### 步骤 4: 测试语言切换 (如果有)

1. **操作**: 切换界面语言 (中文 ↔ English)
2. **期望**: 
   - 界面语言改变
   - 控制台显示: `[TauriStore] 设置 language: en`
3. **验证**:
   - [ ] ✅ 语言切换成功
   - [ ] ✅ 看到保存日志

---

### 步骤 5: 测试持久化 (最关键!)

1. **操作**: 
   - 确保当前主题是 **dark** (暗色)
   - 关闭应用 (点击关闭或 Ctrl+C)
   
2. **重新启动**:
   ```bash
   npm run tauri:dev
   ```

3. **期望**: 
   - 应用启动后**自动使用暗色主题** ✅
   - 不是恢复到默认的亮色 ❌
   
4. **验证**:
   - [ ] ✅ 主题设置被保存
   - [ ] ✅ 重启后正确恢复
   - [ ] ✅ 不需要手动重新设置

---

### 步骤 6: 测试翻译统计 (可选)

1. **操作**: 进行一次翻译操作
2. **期望**: 
   - 累计统计更新
   - 控制台显示: `[TauriStore] 更新累计统计`
3. **重启后**: 统计数据保留
4. **验证**:
   - [ ] ✅ 统计正确更新
   - [ ] ✅ 重启后数据保留

---

### 步骤 7: 检查数据文件 (高级)

**Windows 路径**:
```
C:\Users\{你的用户名}\AppData\Roaming\com.potranslator.gui\app-settings.json
```

**macOS 路径**:
```
~/Library/Application Support/com.potranslator.gui/app-settings.json
```

**Linux 路径**:
```
~/.config/com.potranslator.gui/app-settings.json
```

**打开文件应该看到**:
```json
{
  "theme": "dark",
  "language": "zh-CN",
  "cumulativeStats": {
    "totalTranslated": 0,
    "totalTokens": 0,
    "totalCost": 0,
    "sessionCount": 0,
    "lastUpdated": 1705123456789
  }
}
```

- [ ] ✅ 文件存在
- [ ] ✅ 内容格式正确
- [ ] ✅ 数据可读

---

## 🐛 故障排查

### 问题 1: 控制台没有初始化日志

**可能原因**:
- 代码未正确集成
- 浏览器控制台未打开

**解决方案**:
1. 按 F12 打开开发者工具
2. 切换到 Console 标签
3. 刷新应用 (Ctrl+R)

---

### 问题 2: 主题切换后重启没有保存

**可能原因**:
- TauriStore 保存失败
- 文件权限问题

**排查步骤**:
1. 查看控制台是否有错误
2. 检查是否有 `[TauriStore] 设置 theme: dark` 日志
3. 检查数据文件是否存在
4. 检查目录权限

---

### 问题 3: 迁移失败

**可能原因**:
- localStorage 数据格式不正确
- 权限问题

**解决方案**:
1. 查看迁移错误日志
2. 手动清理 localStorage (浏览器开发工具)
3. 重新启动应用

---

## ✅ 测试通过标准

**必须满足以下所有条件**:

- [x] 应用正常启动
- [x] 看到 Store 初始化日志
- [x] 主题切换正常工作
- [x] **重启后主题设置保留** (最重要!)
- [x] 无控制台错误
- [x] 数据文件正确生成

---

## 📊 测试结果记录

**测试时间**: _____________

**测试人**: _____________

**应用版本**: Tauri 2.x

### 结果

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 应用启动 | ⬜ 通过 / ⬜ 失败 | |
| 初始化日志 | ⬜ 通过 / ⬜ 失败 | |
| 主题切换 | ⬜ 通过 / ⬜ 失败 | |
| 持久化保存 | ⬜ 通过 / ⬜ 失败 | |
| 数据文件 | ⬜ 通过 / ⬜ 失败 | |

### 总体评价

⬜ **全部通过** - Store Plugin 工作正常 ✅  
⬜ **部分通过** - 有些问题需要修复 ⚠️  
⬜ **测试失败** - 需要调试 ❌  

### 问题记录

_____________________________________________

_____________________________________________

_____________________________________________

---

## 🎉 测试完成后

如果所有测试通过:
- ✅ Store Plugin 集成成功！
- ✅ 可以继续下一阶段开发
- ✅ 用户数据持久化正常工作

下一步:
- 阶段 2: Notification Plugin 集成
- 阶段 3: IPC 通道优化

---

**祝测试顺利！** 🚀

