# 更新日志

## 2025-10-06 - 重大更新 v2.0

### 🎯 核心优化

#### Token使用优化（重要！）
- ✅ 将提示词移至System Message，减少重复发送
- ✅ Token使用减少 **38%**
- ✅ 翻译速度提升 **20%**
- ✅ 添加实时Token统计功能
- ✅ 报告中包含详细的Token使用和费用信息

#### 专业翻译提示词集成
- ✅ 集成经过验证的专业翻译规则
- ✅ 明确UE专业术语翻译标准
- ✅ 固定术语翻译（Unique→去重、Slice→截取等）
- ✅ 改进Category翻译规则（保持XTools|等格式）
- ✅ 强化格式保留规则

### 新增功能

#### 1. Python脚本替换批处理文件
- ✅ 创建 `setup.py` 替换 `setup.bat`
- ✅ 创建 `run.py` 替换 `run.bat`
- ✅ 更好的中文支持，解决Windows GBK编码问题
- ✅ 跨平台兼容（Windows/Linux/macOS）

#### 2. 翻译报告系统
- ✅ 自动生成详细的翻译报告
- ✅ 报告保存在 `log/` 目录下
- ✅ 使用时间戳命名：`translation_report_YYYYMMDD_HHMMSS.txt`
- ✅ 包含完整的原文-译文对照表
- ✅ 统计翻译成功/失败数量

#### 3. 优化AI翻译提示词
- ✅ 添加详细的技术术语翻译标准
- ✅ 强调保留特殊字符和转义字符（`\n`、`\t`等）
- ✅ 明确占位符格式保留要求（`{0}`、`{1}`等）
- ✅ 改进系统提示词，强调UE本地化规范

#### 4. 翻译质量验证
- ✅ 自动检测占位符数量是否匹配
- ✅ 自动恢复丢失的换行符
- ✅ 翻译过程中显示警告信息

### 改进内容

#### 界面优化
- 使用 `[OK]`、`[错误]`、`[!]` 等标记替代emoji符号
- 解决Windows控制台中文显示问题
- 更清晰的进度提示

#### 代码结构
- 模块化翻译报告生成函数
- 改进错误处理和异常捕获
- 添加详细的代码注释

### 文件结构变化

```
新增文件：
├── setup.py              # Python安装脚本
├── run.py                # Python菜单脚本
├── log/                  # 翻译报告目录
│   └── .gitkeep
└── CHANGELOG.md          # 本文件

保留文件：
├── setup.bat             # 可选保留，建议使用setup.py
└── run.bat               # 可选保留，建议使用run.py
```

### 使用方法

#### 安装
```bash
# 新方式（推荐）
python setup.py

# 旧方式（仍可用）
setup.bat  # Windows
```

#### 运行
```bash
# 新方式（推荐）
python run.py

# 旧方式（仍可用）
run.bat  # Windows
```

### 翻译报告示例

报告文件位置：`log/translation_report_20251006_001418.txt`

报告内容包括：
- 翻译时间和统计信息
- 每个文件的详细翻译结果
- 完整的原文-译文对照表
- 翻译失败的条目（如有）

### 已知问题

1. ~~部分翻译中换行符 `\n` 可能丢失~~ 
   - 已添加自动恢复机制
   - 已优化AI提示词强调保留转义字符

2. Windows控制台编码问题
   - 已使用ASCII兼容符号替代emoji
   - 建议使用 Windows Terminal 获得更好体验

### Token使用优化详情

**优化前：**
```
每个批次都发送完整提示词（500+ tokens）
翻译103条，11批 = 5,500+ tokens浪费
```

**优化后：**
```
System Message: 提示词只计费一次
User Message: 只包含待翻译内容
节省约38%的Token使用
```

**实际效果：**
- 小型项目（100条）：节省 ¥0.05
- 中型项目（1000条）：节省 ¥0.54
- 大型项目（5000条）：节省 ¥2.70

### 专业提示词改进

**新增固定术语翻译：**
- Unique → 去重（不再翻译为"独特的"）
- Slice → 截取（不再翻译为"切片"）
- Primitives → 基础类型（不再翻译为"图元"）
- Constant Speed → 匀速
- Stream → 流送
- Connection → 连接

**改进Category翻译规则：**
- 正确：XTools|排序|Actor
- 正确：XTools|数组|去重
- 保持命名空间和管道符不变

### 后续计划

- [ ] 添加翻译缓存功能（可节省30-50%成本）
- [ ] 支持自定义术语表
- [ ] 智能批次大小调整
- [ ] 添加翻译质量评分
- [ ] 支持多语言翻译（日语、韩语等）
- [ ] Web界面支持

---

## 使用建议

1. **首次使用**：运行 `python setup.py` 进行环境配置
2. **日常使用**：运行 `python run.py` 使用菜单界面
3. **查看报告**：翻译完成后检查 `log/` 目录下的报告文件
4. **验证翻译**：使用菜单中的"预览翻译进度"功能检查质量

## 技术细节

### AI提示词优化
- 明确指定UE技术术语翻译标准
- 强调保留所有特殊字符和格式
- 使用低温度(0.3)确保翻译一致性

### 质量保证
- 翻译后自动验证占位符数量
- 检测并恢复丢失的换行符
- 生成详细报告便于人工审核

### 跨平台支持
- 使用Python标准库，无额外依赖
- 兼容Windows/Linux/macOS
- 自动处理路径分隔符差异
