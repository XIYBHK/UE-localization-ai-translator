# PO翻译工具 - 升级说明

## 🎉 主要改进

### 1. 跨平台Python脚本
**替换了批处理文件，支持所有操作系统**

| 旧文件 | 新文件 | 说明 |
|--------|--------|------|
| `setup.bat` | `setup.py` | 安装向导 |
| `run.bat` | `run.py` | 主菜单 |

**优势：**
- ✅ 完美支持中文显示（解决GBK编码问题）
- ✅ 跨平台兼容（Windows/Linux/macOS）
- ✅ 更好的错误处理
- ✅ 统一的用户体验

### 2. 翻译报告系统
**每次翻译自动生成详细报告**

```
log/
└── translation_report_20251006_001418.txt
```

**报告内容：**
```
================================================================================
PO文件翻译报告
================================================================================
生成时间: 2025-10-06 00:14:18
翻译文件数: 1
总条目数: 1688
成功翻译: 103
翻译失败: 0
================================================================================

翻译对照表:
--------------------------------------------------------------------------------

[1]
原文: XTools|Collision
译文: XTools|碰撞

[2]
原文: Array Operations
译文: 数组操作

...
```

**用途：**
- 📝 追踪翻译历史
- 🔍 快速定位问题
- ✅ 人工审核参考
- 📊 质量统计分析

### 3. 优化AI提示词
**更准确的翻译质量**

**新增规范：**
```
1. 技术术语标准化
   - Collision → 碰撞
   - Blueprint → 蓝图
   - Component → 组件
   等...

2. 格式保留（重点）
   - 保持转义字符：\n、\t、\r
   - 保持占位符：{0}、{1}、%s
   - 保持特殊符号：|、{}、%%
   
3. 质量验证
   - 自动检测占位符数量
   - 自动恢复丢失的换行符
   - 显示警告信息
```

### 4. 界面优化
**解决Windows控制台显示问题**

| 旧符号 | 新符号 | 说明 |
|--------|--------|------|
| ✓ | [OK] | 成功标记 |
| ✗ | [X] | 失败标记 |
| ❌ | [错误] | 错误提示 |
| ⚠️ | [!] | 警告提示 |

---

## 📖 快速开始

### 第一次使用

```bash
# 1. 安装依赖
python setup.py

# 2. 编辑配置文件 .env
#    填入你的 Moonshot API 密钥

# 3. 开始使用
python run.py
```

### 日常使用

```bash
# 启动菜单
python run.py

# 选择功能：
#   [1] 分析PO文件 - 查看工作量和费用预估
#   [2] 开始翻译 - 执行翻译任务
#   [3] 预览翻译进度 - 查看翻译结果
#   [4] 运行测试 - 测试功能
#   [5] 快速检查 - 快速验证文件
```

### 查看翻译报告

```bash
# 报告位置
cd log/

# 查看最新报告
# Windows
type translation_report_*.txt

# Linux/macOS
cat translation_report_*.txt
```

---

## 🔧 配置文件说明

### .env 配置
```ini
# Moonshot AI API 密钥
MOONSHOT_API_KEY=sk-xxxxx

# PO文件目录
PO_DIR=fy/zh-Hans

# 批量翻译大小（每批处理的条目数）
BATCH_SIZE=10
```

**参数说明：**
- `MOONSHOT_API_KEY`: 必填，从 https://platform.moonshot.cn/ 获取
- `PO_DIR`: 待翻译的PO文件目录
- `BATCH_SIZE`: 每次发送给AI的条目数，建议5-20

---

## 📊 翻译质量保证

### 自动验证机制

1. **占位符检查**
   ```
   原文: Hello {0}, welcome to {1}
   译文: 你好 {0}，欢迎来到 {1}
   ✅ 占位符数量匹配
   ```

2. **换行符恢复**
   ```
   原文: Line 1\nLine 2\n
   译文: 第一行\n第二行\n
   ✅ 自动恢复丢失的 \n
   ```

3. **格式保留**
   ```
   原文: XTools|Collision
   译文: XTools|碰撞
   ✅ 保持命名空间前缀
   ```

### 人工审核建议

1. 翻译完成后查看 `log/` 目录下的报告
2. 重点检查：
   - 技术术语是否准确
   - 占位符是否完整
   - 换行符是否保留
   - 特殊符号是否正确

3. 使用"预览翻译进度"功能抽查

---

## ⚠️ 注意事项

### 1. 换行符问题
- AI可能会删除或修改 `\n` 换行符
- 系统会自动尝试恢复
- 建议人工审核包含换行符的条目

### 2. 占位符问题
- 确保 `{0}`、`{1}` 等占位符数量正确
- 系统会显示警告但不会自动修复
- 需要人工检查并修正

### 3. 特殊术语
- 某些UE专有术语可能翻译不准确
- 建议创建术语表（未来功能）
- 可以通过修改提示词优化

### 4. API费用
- 使用前运行"分析PO文件"预估费用
- 典型5300行文件约 ¥0.5-2.0
- 建议小批量测试后再大规模翻译

---

## 🚀 后续规划

- [ ] 翻译缓存（避免重复翻译）
- [ ] 自定义术语表
- [ ] 翻译质量评分
- [ ] 多语言支持
- [ ] Web界面
- [ ] 批量回滚功能

---

## 📞 问题反馈

如遇到问题，请检查：
1. `log/` 目录下的翻译报告
2. 控制台输出的错误信息
3. `.env` 配置是否正确
4. API密钥是否有效

---

## 📝 文件清单

```
po翻译/
├── setup.py              # 安装脚本（新）
├── run.py                # 主菜单（新）
├── translate.py          # 一键翻译
├── po_translator.py      # 核心翻译库（已优化）
├── batch_translate.py    # 批量翻译（已优化）
├── analyze_po.py         # 统计分析
├── compare_translations.py  # 预览进度
├── quick_check.py        # 快速检查
├── test_translator.py    # 单元测试
├── log/                  # 翻译报告目录（新）
│   └── translation_report_*.txt
├── fy/zh-Hans/          # PO文件目录
├── requirements.txt      # 依赖
├── .env                  # 配置文件
├── README.md            # 使用文档
├── CHANGELOG.md         # 更新日志（新）
└── 升级说明.md          # 本文件（新）
```

---

**祝使用愉快！** 🎉
